"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[696],{6555:function(e,r,t){var n=t(5798);t.o(n,"useParams")&&t.d(r,{useParams:function(){return n.useParams}}),t.o(n,"useRouter")&&t.d(r,{useRouter:function(){return n.useRouter}})},4134:function(e,r,t){t.d(r,{zx:function(){return n.Button},Zb:function(){return o.Card},aY:function(){return o.CardContent},Ol:function(){return o.CardHeader},ll:function(){return o.CardTitle},bu:function(){return u.CustomerList},II:function(){return a.Input},TK:function(){return i.TK},NZ:function(){return l.OnboardingWizard},NV:function(){return w.QuickActions},zc:function(){return d.QuoteCreationForm},vD:function(){return g.QuoteList},Jc:function(){return c.QuotePreview},IW:function(){return f.QuoteShare},j9:function(){return h.RecentQuotes},$4:function(){return s.ServiceList},NF:function(){return p.SettingsPage},Ai:function(){return m.StatsCard},VW:function(){return i.VW},pm:function(){return i.pm}});var n=t(7046),a=t(822);t(1528),t(2518),t(1655);var o=t(5996);t(1140),t(2860),t(9695),t(4244);var i=t(1979);t(3512);var l=t(4014);t(7967),t(4520);var s=t(2638);t(2236),t(6222);var u=t(630);t(6822),t(8304),t(3770),t(4592),t(3347);var d=t(5200),c=t(7200);t(6119);var f=t(4251),g=t(5708),m=t(784),h=t(3357),w=t(6715),p=t(9694)},9307:function(e,r,t){t.d(r,{aC:function(){return n.a},iF:function(){return c},p_:function(){return f},Ad:function(){return v},i1:function(){return E},bu:function(){return m},n8:function(){return p},f_:function(){return A},$_:function(){return w},vR:function(){return _},Su:function(){return g},Hl:function(){return b},C8:function(){return q},LR:function(){return h}});var n=t(6143),a=t(8590),o=t(5001);function i(e){var r,t,n,a,o;return{id:e.id,userId:e.user_id,name:e.name,logoUrl:null!==(r=e.logo_url)&&void 0!==r?r:void 0,phone:null!==(t=e.phone)&&void 0!==t?t:void 0,email:null!==(n=e.email)&&void 0!==n?n:void 0,address:null!==(a=e.address)&&void 0!==a?a:void 0,defaultTerms:null!==(o=e.default_terms)&&void 0!==o?o:void 0,defaultValidityDays:e.default_validity_days,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)}}function l(e){var r,t;return{id:e.id,businessId:e.business_id,name:e.name,description:null!==(r=e.description)&&void 0!==r?r:void 0,price:e.price,category:null!==(t=e.category)&&void 0!==t?t:void 0,isActive:e.is_active,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)}}function s(e){var r,t;return{id:e.id,businessId:e.business_id,name:e.name,phone:e.phone,email:null!==(r=e.email)&&void 0!==r?r:void 0,address:null!==(t=e.address)&&void 0!==t?t:void 0,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)}}function u(e){var r,t,n,a;return{id:e.id,businessId:e.business_id,customerId:null!==(r=e.customer_id)&&void 0!==r?r:void 0,quoteNumber:e.quote_number,status:e.status,subtotal:e.subtotal,discountType:null!==(t=e.discount_type)&&void 0!==t?t:void 0,discountValue:e.discount_value,total:e.total,notes:null!==(n=e.notes)&&void 0!==n?n:void 0,terms:null!==(a=e.terms)&&void 0!==a?a:void 0,validUntil:e.valid_until?new Date(e.valid_until):void 0,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)}}var d=t(4742);function c(){let[e,r]=(0,a.useState)({business:null,loading:!0,error:null}),t=(0,a.useMemo)(()=>(0,o.AY)(),[]),n=(0,a.useCallback)(async()=>{if(!t){r({business:null,loading:!1,error:null});return}r(e=>({...e,loading:!0,error:null}));try{let{data:{user:e}}=await t.auth.getUser();if(!e){r({business:null,loading:!1,error:null});return}let{data:n,error:a}=await t.from("businesses").select("*").eq("user_id",e.id).single();if(a&&"PGRST116"!==a.code)throw Error(a.message);r({business:n?i(n):null,loading:!1,error:null})}catch(e){r(r=>({...r,loading:!1,error:e instanceof Error?e:Error("Failed to fetch business")}))}},[t]);(0,a.useEffect)(()=>{n()},[n]);let l=(0,a.useCallback)(async e=>{if(!t)return null;r(e=>({...e,loading:!0,error:null}));try{let n=d.l6.parse(e),{data:{user:a}}=await t.auth.getUser();if(!a)throw Error("Not authenticated");let o={name:n.name,phone:n.phone||null,email:n.email||null,address:n.address||null,default_terms:n.defaultTerms||null,default_validity_days:n.defaultValidityDays},{data:l,error:s}=await t.from("businesses").update(o).eq("user_id",a.id).select().single();if(s)throw Error(s.message);let u=i(l);return r({business:u,loading:!1,error:null}),u}catch(t){let e=t instanceof Error?t:Error("Failed to update business");return r(r=>({...r,loading:!1,error:e})),null}},[t]),s=(0,a.useCallback)(async e=>{if(!t)return null;try{let{data:{user:r}}=await t.auth.getUser();if(!r)throw Error("Not authenticated");if(!["image/png","image/jpeg","image/jpg"].includes(e.type))throw Error("Invalid file type. Please upload PNG or JPG.");if(e.size>2097152)throw Error("File too large. Maximum size is 2MB.");let a=e.name.split(".").pop(),o="".concat(r.id,"/logo.").concat(a),{error:i}=await t.storage.from("logos").upload(o,e,{upsert:!0});if(i)throw Error(i.message);let{data:{publicUrl:l}}=t.storage.from("logos").getPublicUrl(o),{error:s}=await t.from("businesses").update({logo_url:l}).eq("user_id",r.id);if(s)throw Error(s.message);return await n(),l}catch(t){let e=t instanceof Error?t:Error("Failed to upload logo");return r(r=>({...r,error:e})),null}},[t,n]);return{...e,refetch:n,updateBusiness:l,uploadLogo:s}}function f(){let[e,r]=(0,a.useState)({loading:!1,error:null}),t=(0,a.useMemo)(()=>(0,o.AY)(),[]),n=(0,a.useCallback)(async e=>{if(!t)return null;r({loading:!0,error:null});try{let n=d.l6.parse(e),{data:{user:a}}=await t.auth.getUser();if(!a)throw Error("Not authenticated");let o={user_id:a.id,name:n.name,phone:n.phone||null,email:n.email||null,address:n.address||null,default_terms:n.defaultTerms||null,default_validity_days:n.defaultValidityDays,logo_url:null},{data:l,error:s}=await t.from("businesses").insert(o).select().single();if(s){if("23505"===s.code)throw Error("A business profile already exists for this account");throw Error(s.message)}return r({loading:!1,error:null}),i(l)}catch(e){return r({loading:!1,error:e instanceof Error?e:Error("Failed to create business")}),null}},[t]),l=(0,a.useCallback)(()=>{r(e=>({...e,error:null}))},[]);return{...e,createBusiness:n,clearError:l}}function g(){let[e,r]=(0,a.useState)({services:[],loading:!0,error:null}),t=(0,a.useMemo)(()=>(0,o.AY)(),[]),n=(0,a.useCallback)(async()=>{if(!t){r({services:[],loading:!1,error:null});return}r(e=>({...e,loading:!0,error:null}));try{let{data:{user:e}}=await t.auth.getUser();if(!e){r({services:[],loading:!1,error:null});return}let{data:n,error:a}=await t.from("businesses").select("id").eq("user_id",e.id).single();if(a&&"PGRST116"!==a.code)throw Error(a.message);if(!n){r({services:[],loading:!1,error:null});return}let o=n.id,{data:i,error:s}=await t.from("services").select("*").eq("business_id",o).order("category",{ascending:!0}).order("name",{ascending:!0});if(s)throw Error(s.message);let u=(i||[]).map(e=>l(e));r({services:u,loading:!1,error:null})}catch(e){r(r=>({...r,loading:!1,error:e instanceof Error?e:Error("Failed to fetch services")}))}},[t]);(0,a.useEffect)(()=>{n()},[n]);let i=(0,a.useCallback)(()=>{let r=new Map;return e.services.forEach(e=>{let t=e.category||"Uncategorized",n=r.get(t)||[];r.set(t,[...n,e])}),r},[e.services]);return{...e,refetch:n,getServicesByCategory:i}}function m(){let[e,r]=(0,a.useState)({loading:!1,error:null}),t=(0,a.useMemo)(()=>(0,o.AY)(),[]),n=(0,a.useCallback)(async e=>{r({loading:!0,error:null});try{if(!t)throw Error("Supabase client not available");let n=d.a6.parse(e),{data:{user:a}}=await t.auth.getUser();if(!a)throw Error("Not authenticated");let{data:o,error:i}=await t.from("businesses").select("id").eq("user_id",a.id).single();if(i)throw Error(i.message);if(!o)throw Error("No business profile found. Please complete onboarding first.");let s={business_id:o.id,name:n.name,description:n.description||null,price:n.price,category:n.category||null,is_active:!0},{data:u,error:c}=await t.from("services").insert(s).select().single();if(c)throw Error(c.message);return r({loading:!1,error:null}),l(u)}catch(e){return r({loading:!1,error:e instanceof Error?e:Error("Failed to create service")}),null}},[t]),i=(0,a.useCallback)(()=>{r(e=>({...e,error:null}))},[]);return{...e,createService:n,clearError:i}}function h(){let[e,r]=(0,a.useState)({loading:!1,error:null}),t=(0,a.useMemo)(()=>(0,o.AY)(),[]),n=(0,a.useCallback)(async(e,n)=>{r({loading:!0,error:null});try{if(!t)throw Error("Supabase client not available");let a=d.a6.parse(n),{data:{user:o}}=await t.auth.getUser();if(!o)throw Error("Not authenticated");let{data:i,error:s}=await t.from("businesses").select("id").eq("user_id",o.id).single();if(s)throw Error(s.message);if(!i)throw Error("No business profile found");let u=i.id,c={name:a.name,description:a.description||null,price:a.price,category:a.category||null},{data:f,error:g}=await t.from("services").update(c).eq("id",e).eq("business_id",u).select().single();if(g)throw Error(g.message);return r({loading:!1,error:null}),l(f)}catch(e){return r({loading:!1,error:e instanceof Error?e:Error("Failed to update service")}),null}},[t]),i=(0,a.useCallback)(()=>{r(e=>({...e,error:null}))},[]);return{...e,updateService:n,clearError:i}}function w(){let[e,r]=(0,a.useState)({loading:!1,error:null}),t=(0,a.useMemo)(()=>(0,o.AY)(),[]),n=(0,a.useCallback)(async e=>{r({loading:!0,error:null});try{if(!t)throw Error("Supabase client not available");let{data:{user:n}}=await t.auth.getUser();if(!n)throw Error("Not authenticated");let{data:a,error:o}=await t.from("businesses").select("id").eq("user_id",n.id).single();if(o)throw Error(o.message);if(!a)throw Error("No business profile found");let i=a.id,{error:l}=await t.from("services").update({is_active:!1}).eq("id",e).eq("business_id",i);if(l)throw Error(l.message);return r({loading:!1,error:null}),!0}catch(e){return r({loading:!1,error:e instanceof Error?e:Error("Failed to delete service")}),!1}},[t]),i=(0,a.useCallback)(()=>{r(e=>({...e,error:null}))},[]);return{...e,deleteService:n,clearError:i}}function p(){let[e,r]=(0,a.useState)({customers:[],loading:!0,error:null}),t=(0,a.useMemo)(()=>(0,o.AY)(),[]),n=(0,a.useCallback)(async()=>{if(!t){r({customers:[],loading:!1,error:null});return}r(e=>({...e,loading:!0,error:null}));try{let{data:{user:e}}=await t.auth.getUser();if(!e){r({customers:[],loading:!1,error:null});return}let{data:n,error:a}=await t.from("businesses").select("id").eq("user_id",e.id).single();if(a&&"PGRST116"!==a.code)throw Error(a.message);if(!n){r({customers:[],loading:!1,error:null});return}let o=n.id,{data:i,error:l}=await t.from("customers").select("*").eq("business_id",o).order("name",{ascending:!0});if(l)throw Error(l.message);let u=(i||[]).map(e=>s(e));r({customers:u,loading:!1,error:null})}catch(e){r(r=>({...r,loading:!1,error:e instanceof Error?e:Error("Failed to fetch customers")}))}},[t]);(0,a.useEffect)(()=>{n()},[n]);let i=(0,a.useCallback)(r=>{if(!r.trim())return e.customers;let t=r.toLowerCase().trim();return e.customers.filter(e=>e.name.toLowerCase().includes(t)||e.phone.includes(r)||e.email&&e.email.toLowerCase().includes(t))},[e.customers]);return{...e,refetch:n,searchCustomers:i}}function v(){let[e,r]=(0,a.useState)({loading:!1,error:null}),t=(0,a.useMemo)(()=>(0,o.AY)(),[]),n=(0,a.useCallback)(async e=>{if(!t)return null;r({loading:!0,error:null});try{let n=d._K.parse(e),{data:{user:a}}=await t.auth.getUser();if(!a)throw Error("Not authenticated");let{data:o,error:i}=await t.from("businesses").select("id").eq("user_id",a.id).single();if(i)throw Error(i.message);if(!o)throw Error("No business profile found. Please complete onboarding first.");let l={business_id:o.id,name:n.name,phone:n.phone,email:n.email||null,address:n.address||null},{data:u,error:c}=await t.from("customers").insert(l).select().single();if(c)throw Error(c.message);return r({loading:!1,error:null}),s(u)}catch(e){return r({loading:!1,error:e instanceof Error?e:Error("Failed to create customer")}),null}},[t]),i=(0,a.useCallback)(()=>{r(e=>({...e,error:null}))},[]);return{...e,createCustomer:n,clearError:i}}function b(){let[e,r]=(0,a.useState)({loading:!1,error:null}),t=(0,a.useMemo)(()=>(0,o.AY)(),[]),n=(0,a.useCallback)(async(e,n)=>{if(!t)return null;r({loading:!0,error:null});try{let a=d._K.parse(n),{data:{user:o}}=await t.auth.getUser();if(!o)throw Error("Not authenticated");let{data:i,error:l}=await t.from("businesses").select("id").eq("user_id",o.id).single();if(l)throw Error(l.message);if(!i)throw Error("No business profile found");let u=i.id,c={name:a.name,phone:a.phone,email:a.email||null,address:a.address||null},{data:f,error:g}=await t.from("customers").update(c).eq("id",e).eq("business_id",u).select().single();if(g)throw Error(g.message);return r({loading:!1,error:null}),s(f)}catch(e){return r({loading:!1,error:e instanceof Error?e:Error("Failed to update customer")}),null}},[t]),i=(0,a.useCallback)(()=>{r(e=>({...e,error:null}))},[]);return{...e,updateCustomer:n,clearError:i}}function _(){let[e,r]=(0,a.useState)({quotes:[],loading:!0,error:null}),t=(0,a.useMemo)(()=>(0,o.AY)(),[]),n=(0,a.useCallback)(async()=>{if(!t){r({quotes:[],loading:!1,error:null});return}r(e=>({...e,loading:!0,error:null}));try{let{data:{user:e}}=await t.auth.getUser();if(!e){r({quotes:[],loading:!1,error:null});return}let{data:n,error:a}=await t.from("businesses").select("id").eq("user_id",e.id).single();if(a&&"PGRST116"!==a.code)throw Error(a.message);if(!n){r({quotes:[],loading:!1,error:null});return}let o=n.id,{data:i,error:l}=await t.from("quotes").select("\n          *,\n          customers (*)\n        ").eq("business_id",o).order("created_at",{ascending:!1});if(l)throw Error(l.message);let d=(i||[]).map(e=>{let r=u(e);return e.customers&&(r.customer=s(e.customers)),r});r({quotes:d,loading:!1,error:null})}catch(e){r(r=>({...r,loading:!1,error:e instanceof Error?e:Error("Failed to fetch quotes")}))}},[t]);(0,a.useEffect)(()=>{n()},[n]);let i=(0,a.useCallback)(r=>{let t=e.quotes;if(r.status&&(t=t.filter(e=>e.status===r.status)),r.search&&r.search.trim()){let e=r.search.toLowerCase().trim();t=t.filter(r=>{var t;return r.quoteNumber.toLowerCase().includes(e)||(null===(t=r.customer)||void 0===t?void 0:t.name.toLowerCase().includes(e))})}return t},[e.quotes]);return{...e,refetch:n,filterQuotes:i}}function E(){let[e,r]=(0,a.useState)({loading:!1,error:null}),t=(0,a.useMemo)(()=>(0,o.AY)(),[]),n=(0,a.useCallback)(async e=>{if(!t)return null;r({loading:!0,error:null});try{let{data:{user:n}}=await t.auth.getUser();if(!n)throw Error("Authentication required");let{data:a,error:o}=await t.from("businesses").select("id").eq("user_id",n.id).single();if(o)throw Error(o.message);if(!a)throw Error("Business not found. Please complete onboarding first.");let i=a.id,l=await y(t,i),s={business_id:i,customer_id:e.customerId,quote_number:l,status:"pending",subtotal:e.subtotal,discount_type:e.discountType||null,discount_value:e.discountValue||0,total:e.total,notes:e.notes||null,terms:e.terms||null,valid_until:e.validUntil?e.validUntil.toISOString().split("T")[0]:null},{data:d,error:c}=await t.from("quotes").insert(s).select().single();if(c)throw Error(c.message);let f=u(d);if(e.items.length>0){let r=e.items.map(e=>({quote_id:f.id,service_id:e.serviceId||null,service_name:e.serviceName,quantity:e.quantity,unit_price:e.unitPrice,total_price:e.totalPrice})),{data:n,error:a}=await t.from("quote_items").insert(r).select();if(a)throw Error(a.message);f.items=(n||[]).map(e=>{var r;return{id:e.id,quoteId:e.quote_id,serviceId:null!==(r=e.service_id)&&void 0!==r?r:void 0,serviceName:e.service_name,quantity:e.quantity,unitPrice:e.unit_price,totalPrice:e.total_price,createdAt:new Date(e.created_at)}})}return r({loading:!1,error:null}),f}catch(e){return r({loading:!1,error:e instanceof Error?e:Error("Failed to create quote")}),null}},[t]),i=(0,a.useCallback)(()=>{r({loading:!1,error:null})},[]);return{...e,createQuote:n,reset:i}}async function y(e,r){let t=new Date().getFullYear(),n="QQ-".concat(t,"-"),{data:a,error:o}=await e.from("quotes").select("quote_number").eq("business_id",r).like("quote_number","".concat(n,"%")).order("quote_number",{ascending:!1}).limit(1);if(o)throw Error(o.message);let i=1;if(a&&a.length>0){let e=a[0].quote_number.match(/QQ-\d{4}-(\d+)/);e&&(i=parseInt(e[1],10)+1)}let l=i.toString().padStart(3,"0");return"".concat(n).concat(l)}function q(){let[e,r]=(0,a.useState)({loading:!1,error:null}),t=(0,a.useMemo)(()=>(0,o.AY)(),[]),n=(0,a.useCallback)(async(e,n)=>{if(!t)return null;r({loading:!0,error:null});try{let a={};void 0!==n.status&&(a.status=n.status),void 0!==n.notes&&(a.notes=n.notes),void 0!==n.terms&&(a.terms=n.terms),void 0!==n.validUntil&&(a.valid_until=n.validUntil.toISOString().split("T")[0]);let{data:o,error:i}=await t.from("quotes").update(a).eq("id",e).select().single();if(i)throw Error(i.message);let l=u(o);return r({loading:!1,error:null}),l}catch(e){return r({loading:!1,error:e instanceof Error?e:Error("Failed to update quote")}),null}},[t]),i=(0,a.useCallback)(()=>{r({loading:!1,error:null})},[]);return{...e,updateQuote:n,reset:i}}function C(e,r,t){return e.filter(e=>(function(e,r,t){let n=new Date(e.createdAt);return n.getFullYear()===r&&n.getMonth()===t})(e,r,t))}function A(){let[e,r]=(0,a.useState)({stats:{totalQuotesThisMonth:0,totalAcceptedValueThisMonth:0,totalPendingAmount:0},recentQuotes:[],loading:!0,error:null}),t=(0,a.useMemo)(()=>(0,o.AY)(),[]),n=(0,a.useCallback)(async()=>{if(!t){r(e=>({...e,loading:!1}));return}r(e=>({...e,loading:!0,error:null}));try{let{data:{user:e}}=await t.auth.getUser();if(!e){r(e=>({...e,loading:!1,error:null}));return}let{data:n,error:a}=await t.from("businesses").select("id").eq("user_id",e.id).single();if(a&&"PGRST116"!==a.code)throw Error(a.message);if(!n){r(e=>({...e,loading:!1,error:null}));return}let o=n.id,{data:i,error:l}=await t.from("quotes").select("*").eq("business_id",o).order("created_at",{ascending:!1});if(l)throw Error(l.message);let s=(i||[]).map(e=>u(e)),d=new Date,c=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Date;return{totalQuotesThisMonth:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Date,t=r.getFullYear();return C(e,t,r.getMonth()).length}(e,r),totalAcceptedValueThisMonth:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Date,t=r.getFullYear();return C(e,t,r.getMonth()).filter(e=>"accepted"===e.status).reduce((e,r)=>e+r.total,0)}(e,r),totalPendingAmount:e.filter(e=>"pending"===e.status).reduce((e,r)=>e+r.total,0)}}(s,d),f=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;return[...e].sort((e,r)=>new Date(r.createdAt).getTime()-new Date(e.createdAt).getTime()).slice(0,r)}(s,5);r({stats:c,recentQuotes:f,loading:!1,error:null})}catch(e){r(r=>({...r,loading:!1,error:e instanceof Error?e:Error("Failed to fetch dashboard stats")}))}},[t]);return(0,a.useEffect)(()=>{n()},[n]),{...e,refetch:n}}}}]);