(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[744],{9314:function(e,t,s){Promise.resolve().then(s.bind(s,1419))},1419:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return o}});var a=s(9566),n=s(8590),i=s(6555),l=s(4134),c=s(9307);function o(){let{user:e,loading:t,signOut:s}=(0,c.aC)(),{business:o,loading:r}=(0,c.iF)(),{quotes:u,loading:d,error:h,refetch:m}=(0,c.vR)(),{updateQuote:x,loading:p}=(0,c.C8)(),{createQuote:f,loading:g}=(0,c.i1)(),v=(0,i.useRouter)();(0,n.useEffect)(()=>{t||e||v.push("/")},[e,t,v]),(0,n.useEffect)(()=>{t||r||!e||o||v.push("/onboarding")},[e,t,o,r,v]),(0,n.useEffect)(()=>{let e=async()=>{let e=new Date,t=u.filter(t=>"pending"===t.status&&t.validUntil&&new Date(t.validUntil)<e);for(let e of t)await x(e.id,{status:"expired"});t.length>0&&m()};!d&&u.length>0&&e()},[u,d,x,m]);let w=async()=>{await s(),v.push("/")},j=async e=>{if(!e.items||0===e.items.length||!e.customerId){v.push("/quotes/new?duplicate=".concat(e.id));return}let t=e.validUntil?Math.max(1,Math.ceil((new Date(e.validUntil).getTime()-Date.now())/864e5)):7,s=new Date;s.setDate(s.getDate()+t);let a=await f({customerId:e.customerId,items:e.items.map(e=>({serviceId:e.serviceId,serviceName:e.serviceName,quantity:e.quantity,unitPrice:e.unitPrice,totalPrice:e.totalPrice})),subtotal:e.subtotal,discountType:e.discountType,discountValue:e.discountValue,total:e.total,notes:e.notes,terms:e.terms,validUntil:s});a&&v.push("/quotes/".concat(a.id))},b=async(e,t)=>{await x(e,{status:t}),m()};return t||r?(0,a.jsx)("div",{className:"min-h-screen bg-background flex items-center justify-center",children:(0,a.jsx)(l.TK,{size:"lg"})}):e&&o?(0,a.jsx)("main",{className:"min-h-screen bg-background p-8",children:(0,a.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h1",{className:"text-3xl font-bold",children:[(0,a.jsx)("span",{className:"text-halloween-purple",children:"Spooky"}),(0,a.jsx)("span",{className:"text-halloween-orange",children:"Quote"}),(0,a.jsx)("span",{className:"ml-2",children:"\uD83C\uDF83"})]}),(0,a.jsx)("p",{className:"text-text-muted mt-1",children:o.name})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(l.zx,{variant:"primary",onClick:()=>v.push("/quotes/new"),children:"+ New Quote"}),(0,a.jsx)(l.zx,{variant:"ghost",onClick:()=>v.push("/dashboard"),children:"Dashboard"}),(0,a.jsx)(l.zx,{variant:"ghost",onClick:w,children:"Sign Out"})]})]}),(0,a.jsx)("div",{className:"bg-surface rounded-xl p-6 border border-halloween-purple/20",children:(0,a.jsx)(l.vD,{quotes:u,loading:d,error:h,onViewQuote:e=>{v.push("/quotes/".concat(e.id))},onDuplicateQuote:j,onUpdateStatus:b,onRefetch:m,duplicateLoading:g,statusUpdateLoading:p})})]})}):null}}},function(e){e.O(0,[959,40,696,977,844,560],function(){return e(e.s=9314)}),_N_E=e.O()}]);