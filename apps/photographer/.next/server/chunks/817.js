"use strict";exports.id=817,exports.ids=[817],exports.modules={81971:(e,r,t)=>{var a=t(98484);t.o(a,"useParams")&&t.d(r,{useParams:function(){return a.useParams}}),t.o(a,"useRouter")&&t.d(r,{useRouter:function(){return a.useRouter}})},44057:(e,r,t)=>{t.d(r,{zx:()=>a.Button,Zb:()=>i.Card,aY:()=>i.CardContent,Ol:()=>i.CardHeader,ll:()=>i.CardTitle,bu:()=>u.CustomerList,II:()=>o.Input,TK:()=>s.TK,NZ:()=>l.OnboardingWizard,NV:()=>w.QuickActions,zc:()=>d.QuoteCreationForm,vD:()=>g.QuoteList,Jc:()=>c.QuotePreview,IW:()=>f.QuoteShare,j9:()=>h.RecentQuotes,$4:()=>n.ServiceList,NF:()=>p.SettingsPage,Ai:()=>m.StatsCard,VW:()=>s.VW,pm:()=>s.pm});var a=t(52834),o=t(45733);t(57921),t(52534),t(43121);var i=t(12259);t(71619),t(93102),t(35650),t(92912);var s=t(15807);t(59020);var l=t(42509);t(65706),t(80444);var n=t(59839);t(68305),t(69981);var u=t(31899);t(94367),t(12977),t(50411),t(36351),t(33968);var d=t(62516),c=t(20898);t(46495);var f=t(87473),g=t(40658),m=t(4168),h=t(24888),w=t(55771),p=t(88909)},18378:(e,r,t)=>{t.d(r,{aC:()=>a.a,iF:()=>c,p_:()=>f,Ad:()=>b,i1:()=>v,bu:()=>m,n8:()=>p,f_:()=>A,$_:()=>w,vR:()=>E,Su:()=>g,Hl:()=>_,C8:()=>q,LR:()=>h});var a=t(94441),o=t(70371),i=t(97270);function s(e){return{id:e.id,userId:e.user_id,name:e.name,logoUrl:e.logo_url??void 0,phone:e.phone??void 0,email:e.email??void 0,address:e.address??void 0,defaultTerms:e.default_terms??void 0,defaultValidityDays:e.default_validity_days,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)}}function l(e){return{id:e.id,businessId:e.business_id,name:e.name,description:e.description??void 0,price:e.price,category:e.category??void 0,isActive:e.is_active,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)}}function n(e){return{id:e.id,businessId:e.business_id,name:e.name,phone:e.phone,email:e.email??void 0,address:e.address??void 0,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)}}function u(e){return{id:e.id,businessId:e.business_id,customerId:e.customer_id??void 0,quoteNumber:e.quote_number,status:e.status,subtotal:e.subtotal,discountType:e.discount_type??void 0,discountValue:e.discount_value,total:e.total,notes:e.notes??void 0,terms:e.terms??void 0,validUntil:e.valid_until?new Date(e.valid_until):void 0,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)}}var d=t(69656);function c(){let[e,r]=(0,o.useState)({business:null,loading:!0,error:null}),t=(0,o.useMemo)(()=>(0,i.AY)(),[]),a=(0,o.useCallback)(async()=>{if(!t){r({business:null,loading:!1,error:null});return}r(e=>({...e,loading:!0,error:null}));try{let{data:{user:e}}=await t.auth.getUser();if(!e){r({business:null,loading:!1,error:null});return}let{data:a,error:o}=await t.from("businesses").select("*").eq("user_id",e.id).single();if(o&&"PGRST116"!==o.code)throw Error(o.message);r({business:a?s(a):null,loading:!1,error:null})}catch(e){r(r=>({...r,loading:!1,error:e instanceof Error?e:Error("Failed to fetch business")}))}},[t]),l=(0,o.useCallback)(async e=>{if(!t)return null;r(e=>({...e,loading:!0,error:null}));try{let a=d.l6.parse(e),{data:{user:o}}=await t.auth.getUser();if(!o)throw Error("Not authenticated");let i={name:a.name,phone:a.phone||null,email:a.email||null,address:a.address||null,default_terms:a.defaultTerms||null,default_validity_days:a.defaultValidityDays},{data:l,error:n}=await t.from("businesses").update(i).eq("user_id",o.id).select().single();if(n)throw Error(n.message);let u=s(l);return r({business:u,loading:!1,error:null}),u}catch(t){let e=t instanceof Error?t:Error("Failed to update business");return r(r=>({...r,loading:!1,error:e})),null}},[t]),n=(0,o.useCallback)(async e=>{if(!t)return null;try{let{data:{user:r}}=await t.auth.getUser();if(!r)throw Error("Not authenticated");if(!["image/png","image/jpeg","image/jpg"].includes(e.type))throw Error("Invalid file type. Please upload PNG or JPG.");if(e.size>2097152)throw Error("File too large. Maximum size is 2MB.");let o=e.name.split(".").pop(),i=`${r.id}/logo.${o}`,{error:s}=await t.storage.from("logos").upload(i,e,{upsert:!0});if(s)throw Error(s.message);let{data:{publicUrl:l}}=t.storage.from("logos").getPublicUrl(i),{error:n}=await t.from("businesses").update({logo_url:l}).eq("user_id",r.id);if(n)throw Error(n.message);return await a(),l}catch(t){let e=t instanceof Error?t:Error("Failed to upload logo");return r(r=>({...r,error:e})),null}},[t,a]);return{...e,refetch:a,updateBusiness:l,uploadLogo:n}}function f(){let[e,r]=(0,o.useState)({loading:!1,error:null}),t=(0,o.useMemo)(()=>(0,i.AY)(),[]),a=(0,o.useCallback)(async e=>{if(!t)return null;r({loading:!0,error:null});try{let a=d.l6.parse(e),{data:{user:o}}=await t.auth.getUser();if(!o)throw Error("Not authenticated");let i={user_id:o.id,name:a.name,phone:a.phone||null,email:a.email||null,address:a.address||null,default_terms:a.defaultTerms||null,default_validity_days:a.defaultValidityDays,logo_url:null},{data:l,error:n}=await t.from("businesses").insert(i).select().single();if(n){if("23505"===n.code)throw Error("A business profile already exists for this account");throw Error(n.message)}return r({loading:!1,error:null}),s(l)}catch(e){return r({loading:!1,error:e instanceof Error?e:Error("Failed to create business")}),null}},[t]),l=(0,o.useCallback)(()=>{r(e=>({...e,error:null}))},[]);return{...e,createBusiness:a,clearError:l}}function g(){let[e,r]=(0,o.useState)({services:[],loading:!0,error:null}),t=(0,o.useMemo)(()=>(0,i.AY)(),[]),a=(0,o.useCallback)(async()=>{if(!t){r({services:[],loading:!1,error:null});return}r(e=>({...e,loading:!0,error:null}));try{let{data:{user:e}}=await t.auth.getUser();if(!e){r({services:[],loading:!1,error:null});return}let{data:a,error:o}=await t.from("businesses").select("id").eq("user_id",e.id).single();if(o&&"PGRST116"!==o.code)throw Error(o.message);if(!a){r({services:[],loading:!1,error:null});return}let i=a.id,{data:s,error:n}=await t.from("services").select("*").eq("business_id",i).order("category",{ascending:!0}).order("name",{ascending:!0});if(n)throw Error(n.message);let u=(s||[]).map(e=>l(e));r({services:u,loading:!1,error:null})}catch(e){r(r=>({...r,loading:!1,error:e instanceof Error?e:Error("Failed to fetch services")}))}},[t]),s=(0,o.useCallback)(()=>{let r=new Map;return e.services.forEach(e=>{let t=e.category||"Uncategorized",a=r.get(t)||[];r.set(t,[...a,e])}),r},[e.services]);return{...e,refetch:a,getServicesByCategory:s}}function m(){let[e,r]=(0,o.useState)({loading:!1,error:null}),t=(0,o.useMemo)(()=>(0,i.AY)(),[]),a=(0,o.useCallback)(async e=>{r({loading:!0,error:null});try{if(!t)throw Error("Supabase client not available");let a=d.a6.parse(e),{data:{user:o}}=await t.auth.getUser();if(!o)throw Error("Not authenticated");let{data:i,error:s}=await t.from("businesses").select("id").eq("user_id",o.id).single();if(s)throw Error(s.message);if(!i)throw Error("No business profile found. Please complete onboarding first.");let n={business_id:i.id,name:a.name,description:a.description||null,price:a.price,category:a.category||null,is_active:!0},{data:u,error:c}=await t.from("services").insert(n).select().single();if(c)throw Error(c.message);return r({loading:!1,error:null}),l(u)}catch(e){return r({loading:!1,error:e instanceof Error?e:Error("Failed to create service")}),null}},[t]),s=(0,o.useCallback)(()=>{r(e=>({...e,error:null}))},[]);return{...e,createService:a,clearError:s}}function h(){let[e,r]=(0,o.useState)({loading:!1,error:null}),t=(0,o.useMemo)(()=>(0,i.AY)(),[]),a=(0,o.useCallback)(async(e,a)=>{r({loading:!0,error:null});try{if(!t)throw Error("Supabase client not available");let o=d.a6.parse(a),{data:{user:i}}=await t.auth.getUser();if(!i)throw Error("Not authenticated");let{data:s,error:n}=await t.from("businesses").select("id").eq("user_id",i.id).single();if(n)throw Error(n.message);if(!s)throw Error("No business profile found");let u=s.id,c={name:o.name,description:o.description||null,price:o.price,category:o.category||null},{data:f,error:g}=await t.from("services").update(c).eq("id",e).eq("business_id",u).select().single();if(g)throw Error(g.message);return r({loading:!1,error:null}),l(f)}catch(e){return r({loading:!1,error:e instanceof Error?e:Error("Failed to update service")}),null}},[t]),s=(0,o.useCallback)(()=>{r(e=>({...e,error:null}))},[]);return{...e,updateService:a,clearError:s}}function w(){let[e,r]=(0,o.useState)({loading:!1,error:null}),t=(0,o.useMemo)(()=>(0,i.AY)(),[]),a=(0,o.useCallback)(async e=>{r({loading:!0,error:null});try{if(!t)throw Error("Supabase client not available");let{data:{user:a}}=await t.auth.getUser();if(!a)throw Error("Not authenticated");let{data:o,error:i}=await t.from("businesses").select("id").eq("user_id",a.id).single();if(i)throw Error(i.message);if(!o)throw Error("No business profile found");let s=o.id,{error:l}=await t.from("services").update({is_active:!1}).eq("id",e).eq("business_id",s);if(l)throw Error(l.message);return r({loading:!1,error:null}),!0}catch(e){return r({loading:!1,error:e instanceof Error?e:Error("Failed to delete service")}),!1}},[t]),s=(0,o.useCallback)(()=>{r(e=>({...e,error:null}))},[]);return{...e,deleteService:a,clearError:s}}function p(){let[e,r]=(0,o.useState)({customers:[],loading:!0,error:null}),t=(0,o.useMemo)(()=>(0,i.AY)(),[]),a=(0,o.useCallback)(async()=>{if(!t){r({customers:[],loading:!1,error:null});return}r(e=>({...e,loading:!0,error:null}));try{let{data:{user:e}}=await t.auth.getUser();if(!e){r({customers:[],loading:!1,error:null});return}let{data:a,error:o}=await t.from("businesses").select("id").eq("user_id",e.id).single();if(o&&"PGRST116"!==o.code)throw Error(o.message);if(!a){r({customers:[],loading:!1,error:null});return}let i=a.id,{data:s,error:l}=await t.from("customers").select("*").eq("business_id",i).order("name",{ascending:!0});if(l)throw Error(l.message);let u=(s||[]).map(e=>n(e));r({customers:u,loading:!1,error:null})}catch(e){r(r=>({...r,loading:!1,error:e instanceof Error?e:Error("Failed to fetch customers")}))}},[t]),s=(0,o.useCallback)(r=>{if(!r.trim())return e.customers;let t=r.toLowerCase().trim();return e.customers.filter(e=>e.name.toLowerCase().includes(t)||e.phone.includes(r)||e.email&&e.email.toLowerCase().includes(t))},[e.customers]);return{...e,refetch:a,searchCustomers:s}}function b(){let[e,r]=(0,o.useState)({loading:!1,error:null}),t=(0,o.useMemo)(()=>(0,i.AY)(),[]),a=(0,o.useCallback)(async e=>{if(!t)return null;r({loading:!0,error:null});try{let a=d._K.parse(e),{data:{user:o}}=await t.auth.getUser();if(!o)throw Error("Not authenticated");let{data:i,error:s}=await t.from("businesses").select("id").eq("user_id",o.id).single();if(s)throw Error(s.message);if(!i)throw Error("No business profile found. Please complete onboarding first.");let l={business_id:i.id,name:a.name,phone:a.phone,email:a.email||null,address:a.address||null},{data:u,error:c}=await t.from("customers").insert(l).select().single();if(c)throw Error(c.message);return r({loading:!1,error:null}),n(u)}catch(e){return r({loading:!1,error:e instanceof Error?e:Error("Failed to create customer")}),null}},[t]),s=(0,o.useCallback)(()=>{r(e=>({...e,error:null}))},[]);return{...e,createCustomer:a,clearError:s}}function _(){let[e,r]=(0,o.useState)({loading:!1,error:null}),t=(0,o.useMemo)(()=>(0,i.AY)(),[]),a=(0,o.useCallback)(async(e,a)=>{if(!t)return null;r({loading:!0,error:null});try{let o=d._K.parse(a),{data:{user:i}}=await t.auth.getUser();if(!i)throw Error("Not authenticated");let{data:s,error:l}=await t.from("businesses").select("id").eq("user_id",i.id).single();if(l)throw Error(l.message);if(!s)throw Error("No business profile found");let u=s.id,c={name:o.name,phone:o.phone,email:o.email||null,address:o.address||null},{data:f,error:g}=await t.from("customers").update(c).eq("id",e).eq("business_id",u).select().single();if(g)throw Error(g.message);return r({loading:!1,error:null}),n(f)}catch(e){return r({loading:!1,error:e instanceof Error?e:Error("Failed to update customer")}),null}},[t]),s=(0,o.useCallback)(()=>{r(e=>({...e,error:null}))},[]);return{...e,updateCustomer:a,clearError:s}}function E(){let[e,r]=(0,o.useState)({quotes:[],loading:!0,error:null}),t=(0,o.useMemo)(()=>(0,i.AY)(),[]),a=(0,o.useCallback)(async()=>{if(!t){r({quotes:[],loading:!1,error:null});return}r(e=>({...e,loading:!0,error:null}));try{let{data:{user:e}}=await t.auth.getUser();if(!e){r({quotes:[],loading:!1,error:null});return}let{data:a,error:o}=await t.from("businesses").select("id").eq("user_id",e.id).single();if(o&&"PGRST116"!==o.code)throw Error(o.message);if(!a){r({quotes:[],loading:!1,error:null});return}let i=a.id,{data:s,error:l}=await t.from("quotes").select(`
          *,
          customers (*)
        `).eq("business_id",i).order("created_at",{ascending:!1});if(l)throw Error(l.message);let d=(s||[]).map(e=>{let r=u(e);return e.customers&&(r.customer=n(e.customers)),r});r({quotes:d,loading:!1,error:null})}catch(e){r(r=>({...r,loading:!1,error:e instanceof Error?e:Error("Failed to fetch quotes")}))}},[t]),s=(0,o.useCallback)(r=>{let t=e.quotes;if(r.status&&(t=t.filter(e=>e.status===r.status)),r.search&&r.search.trim()){let e=r.search.toLowerCase().trim();t=t.filter(r=>r.quoteNumber.toLowerCase().includes(e)||r.customer?.name.toLowerCase().includes(e))}return t},[e.quotes]);return{...e,refetch:a,filterQuotes:s}}function v(){let[e,r]=(0,o.useState)({loading:!1,error:null}),t=(0,o.useMemo)(()=>(0,i.AY)(),[]),a=(0,o.useCallback)(async e=>{if(!t)return null;r({loading:!0,error:null});try{let{data:{user:a}}=await t.auth.getUser();if(!a)throw Error("Authentication required");let{data:o,error:i}=await t.from("businesses").select("id").eq("user_id",a.id).single();if(i)throw Error(i.message);if(!o)throw Error("Business not found. Please complete onboarding first.");let s=o.id,l=await y(t,s),n={business_id:s,customer_id:e.customerId,quote_number:l,status:"pending",subtotal:e.subtotal,discount_type:e.discountType||null,discount_value:e.discountValue||0,total:e.total,notes:e.notes||null,terms:e.terms||null,valid_until:e.validUntil?e.validUntil.toISOString().split("T")[0]:null},{data:d,error:c}=await t.from("quotes").insert(n).select().single();if(c)throw Error(c.message);let f=u(d);if(e.items.length>0){let r=e.items.map(e=>({quote_id:f.id,service_id:e.serviceId||null,service_name:e.serviceName,quantity:e.quantity,unit_price:e.unitPrice,total_price:e.totalPrice})),{data:a,error:o}=await t.from("quote_items").insert(r).select();if(o)throw Error(o.message);f.items=(a||[]).map(e=>({id:e.id,quoteId:e.quote_id,serviceId:e.service_id??void 0,serviceName:e.service_name,quantity:e.quantity,unitPrice:e.unit_price,totalPrice:e.total_price,createdAt:new Date(e.created_at)}))}return r({loading:!1,error:null}),f}catch(e){return r({loading:!1,error:e instanceof Error?e:Error("Failed to create quote")}),null}},[t]),s=(0,o.useCallback)(()=>{r({loading:!1,error:null})},[]);return{...e,createQuote:a,reset:s}}async function y(e,r){let t=new Date().getFullYear(),a=`QQ-${t}-`,{data:o,error:i}=await e.from("quotes").select("quote_number").eq("business_id",r).like("quote_number",`${a}%`).order("quote_number",{ascending:!1}).limit(1);if(i)throw Error(i.message);let s=1;if(o&&o.length>0){let e=o[0].quote_number.match(/QQ-\d{4}-(\d+)/);e&&(s=parseInt(e[1],10)+1)}let l=s.toString().padStart(3,"0");return`${a}${l}`}function q(){let[e,r]=(0,o.useState)({loading:!1,error:null}),t=(0,o.useMemo)(()=>(0,i.AY)(),[]),a=(0,o.useCallback)(async(e,a)=>{if(!t)return null;r({loading:!0,error:null});try{let o={};void 0!==a.status&&(o.status=a.status),void 0!==a.notes&&(o.notes=a.notes),void 0!==a.terms&&(o.terms=a.terms),void 0!==a.validUntil&&(o.valid_until=a.validUntil.toISOString().split("T")[0]);let{data:i,error:s}=await t.from("quotes").update(o).eq("id",e).select().single();if(s)throw Error(s.message);let l=u(i);return r({loading:!1,error:null}),l}catch(e){return r({loading:!1,error:e instanceof Error?e:Error("Failed to update quote")}),null}},[t]),s=(0,o.useCallback)(()=>{r({loading:!1,error:null})},[]);return{...e,updateQuote:a,reset:s}}function C(e,r,t){return e.filter(e=>(function(e,r,t){let a=new Date(e.createdAt);return a.getFullYear()===r&&a.getMonth()===t})(e,r,t))}function A(){let[e,r]=(0,o.useState)({stats:{totalQuotesThisMonth:0,totalAcceptedValueThisMonth:0,totalPendingAmount:0},recentQuotes:[],loading:!0,error:null}),t=(0,o.useMemo)(()=>(0,i.AY)(),[]),a=(0,o.useCallback)(async()=>{if(!t){r(e=>({...e,loading:!1}));return}r(e=>({...e,loading:!0,error:null}));try{let{data:{user:e}}=await t.auth.getUser();if(!e){r(e=>({...e,loading:!1,error:null}));return}let{data:a,error:o}=await t.from("businesses").select("id").eq("user_id",e.id).single();if(o&&"PGRST116"!==o.code)throw Error(o.message);if(!a){r(e=>({...e,loading:!1,error:null}));return}let i=a.id,{data:s,error:l}=await t.from("quotes").select("*").eq("business_id",i).order("created_at",{ascending:!1});if(l)throw Error(l.message);let n=(s||[]).map(e=>u(e)),d=new Date,c=function(e,r=new Date){return{totalQuotesThisMonth:function(e,r=new Date){let t=r.getFullYear();return C(e,t,r.getMonth()).length}(e,r),totalAcceptedValueThisMonth:function(e,r=new Date){let t=r.getFullYear();return C(e,t,r.getMonth()).filter(e=>"accepted"===e.status).reduce((e,r)=>e+r.total,0)}(e,r),totalPendingAmount:e.filter(e=>"pending"===e.status).reduce((e,r)=>e+r.total,0)}}(n,d),f=function(e,r=5){return[...e].sort((e,r)=>new Date(r.createdAt).getTime()-new Date(e.createdAt).getTime()).slice(0,r)}(n,5);r({stats:c,recentQuotes:f,loading:!1,error:null})}catch(e){r(r=>({...r,loading:!1,error:e instanceof Error?e:Error("Failed to fetch dashboard stats")}))}},[t]);return{...e,refetch:a}}}};